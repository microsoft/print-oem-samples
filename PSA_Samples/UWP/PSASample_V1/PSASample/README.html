<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="c-print-support-app">C# Print Support App</h1>
<ul>
<li><a href="#c-print-support-app">C# Print Support App</a>
<ul>
<li><a href="#release-history">Release History</a></li>
<li><a href="#known-issues">Known Issues</a>
<ul>
<li><a href="#p1">P1</a></li>
<li><a href="#p2">P2</a></li>
</ul>
</li>
<li><a href="#remarks">Remarks</a></li>
<li><a href="#resources">Resources</a></li>
</ul>
</li>
</ul>
<h2 id="release-history">Release History</h2>
<details>
<summary>2021-02-22 (v7)</summary>
<p>Many updates, including:</p>
<ul>
<li>Demonstration of IPrintWorkflowXpsReceiver to load and render pages as they become available, rather than waiting for the entire XpsDocument to load before showing the initial preview.</li>
<li>Restructuring of overall architecture to better seperate responsiblities, especially in watermark preview UI elements and in the watermarking process.</li>
<li>Watermarking process standardized between preview and print background tasks through XpsWatermarker.</li>
<li>Rendering preview is done in the background to avoid blocking the UI thread.</li>
<li>Preview is rendered immediately as watermark text is typed, and in response to other UI events, without need for an explicit &quot;preview&quot; button.</li>
<li>Improved UI for choosing relative watermark position on the page.</li>
<li>Add a cancel button to abort the workflow from the print dialog.</li>
<li>Demonstrate getting and setting custom IPP attributes.</li>
</ul>
</details>
<details>
<summary>2020-12-17 (v6)</summary>
<ul>
<li>Updated PrintSupportWorkflowBackgroundTask.cs - Update PSA sample to new API CreateJobOnPrinter() and remove GetJobAttributes().</li>
</ul>
</details>
<details>
<summary>2020-11-06 (v5)</summary>
<ul>
<li>Updated PrintTicketManipulationExample.xaml.cs - Print ticket options are selected from the Print Ticket object, instead of the Print Capabilities object.</li>
<li>Added UserLaunchMainPage.xaml.cs - Added example to obtain the IP address of IPP Printers connected to the device.</li>
</ul>
</details>
<details>
<summary>2020-08-13 (v4)</summary>
<ul>
<li>Added OnSessionJobNotification example. See <code>JobNotificationExample.xaml.cs</code>
<ul>
<li>Small refactoring was done on <code>WatermarkManipulationExample.xaml.cs</code> and <code>JobActivatedMainPage.xaml.cs</code></li>
</ul>
</li>
<li>Added AddCustomMediaType example and removed SetAsDefaultPageMediaSize example. See <code>PrintSupportExtensionBackGroundTask.cs</code>
<ul>
<li>Currently the default values on the print ticket cannot be changed. The sample now adds a new selectable option for <code>PageMediaType</code>.</li>
</ul>
</li>
<li>Added GetJobAttributes example. See <code>PrintSupportWorkflowBackgroundTask.cs</code></li>
</ul>
</details>
<details>
<summary>2020-07-14 (v3)</summary>
<ul>
<li>Package.appxmanifest
<ul>
<li>Added <code>privateNetworkClientServer</code> to Capabilities section. This is to allow IPP requests to be made by the app.</li>
<li>Added <code>uap10:SupportsMultipleInstances=&quot;true&quot;</code> to Application section in order to support multi-instance app.</li>
</ul>
</li>
<li>XpsDocument
<ul>
<li>Replaced <code>args.SourceContent.GetInputStream()</code> with <code>args.SourceContent.GetContentFileAsync</code> in OnPdlModificationRequested. <code>GetContentFileAsync</code> is the proper way to get the document data.</li>
<li><code>CLSID_XPSRAS_FACTORY</code> is replaced with <code>CLSID_XPSRASTERIZER_FACTORY</code> in XpsDocument::ConvertXPStoBMP.</li>
</ul>
</li>
<li>Watermark
<ul>
<li>UI closes after clicking <code>Print</code>.</li>
</ul>
</li>
</ul>
</details>
<details>
<summary>2020-06-30 (v2)</summary>
<ul>
<li>Updated watermark example.
<ul>
<li>Added document preview.</li>
<li>Added ability to add a custom watermark image to the XPS document.</li>
</ul>
</li>
<li>Updated <code>PrintSupportWorkflowBackgroundTask.OnPdlModificationRequested</code> to convert the XPS document to a printer supported PDL, instead of only XPS-&gt;PDF.</li>
<li>Added <code>PrintSupportWorkflowBackgroundTask.GetDocumentFormatDefault</code> to get the <code>document-format-default</code> IPP attribute from the printer.</li>
<li>Added <code>PrintSupportExtensionBackGroundTask.OnSessionPrintDeviceCapabilitiesChanged</code> to update the default page media size.
<ul>
<li><strong>Issue</strong>: We are investigating an issue where the default print ticket does not reflect the udpated PDC values.</li>
</ul>
</li>
<li>New contract IDs are available. Please update <code>Package.appxmanifest</code>. See usage in files listed below.
<ul>
<li>
<p><code>Package.appxmanifest</code></p>
<ol>
<li>Add the new namespace <code>xmlns:uap12=&quot;http://schemas.microsoft.com/appx/manifest/uap/windows10/12&quot;</code>.</li>
<li>Add <code>uap12</code> to the space separated list of <code>IgnorableNamespaces</code>.</li>
<li>Update <code>TargetDeviceFamily</code> as shown below:
<blockquote>
<p>TargetDeviceFamily Name=&quot;Windows.Universal&quot; MinVersion=&quot;10.0.0.0&quot; MaxVersionTested=&quot;10.0.0.0&quot;</p>
</blockquote>
</li>
<li>Update the contract IDs.</li>
</ol>
<ul>
<li>Remove
<ul>
<li><code>windows.printTaskSettings</code></li>
<li><code>windows.printWorkflowForegroundTask</code></li>
<li><code>windows.printWorkflowBackgroundTask</code></li>
</ul>
</li>
<li>Add
<ul>
<li><code>windows.printSupportExtension</code></li>
<li><code>windows.printSupportWorkflow</code></li>
<li><code>windows.printSupportSettingsUI</code></li>
<li><code>windows.printSupportJobUI</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>windows.printSupportExtension</code></p>
<ul>
<li><code>PrintSupportExtensionBackGroundTask.cs</code>.</li>
</ul>
</li>
<li>
<p><code>windows.printSupportWorkflow</code></p>
<ul>
<li><code>PrintSupportWorkflowBackgroundTask.cs</code>.</li>
</ul>
</li>
<li>
<p><code>windows.printSupportSettingsUI</code></p>
<ul>
<li><code>JobActivatedMainPage.xaml.cs</code></li>
<li><code>WatermarkManipulationExample.xaml.cs</code></li>
</ul>
</li>
<li>
<p><code>windows.printSupportJobUI</code></p>
<ul>
<li><code>SettingsActivatedMainPage.xaml.cs</code></li>
<li><code>PrintTicketManipulationExample.xaml.cs</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</details>
<details>
<summary>2020-06-02 (v1)</summary>
<ul>
<li>Initial C# Sample PSA prepared for print partners.</li>
</ul>
</details>
<h2 id="known-issues">Known Issues</h2>
<h3 id="p1">P1</h3>
<h3 id="p2">P2</h3>
<ul>
<li><s><code>LaunchAndCompleteUIAsync</code> launches the PSA behind other windows.</s> [Fixed in 2020-07-14 build]
<ul>
<li>This is fixed with the exception of when printing from the Maps app.</li>
</ul>
</li>
</ul>
<details>
<summary>Fixed</summary>
<ul>
<li><s>Printdialog crashes when PSA is launched and closed without modifying the print ticket settings.</s> [Fixed in 2020-06-30 build]</li>
<li><s>PSA background tasks are all in-proc. This means that PSA can not be run as a multi-instance app.</s> [Fixed in 2020-07-14 build]</li>
<li><s>Currently, the PSA background tasks all have a 25 second time out period. If the background tasks runs for more than 25s, it will be terminated by the system. The timeout will be removed in a future release.</s> [Fixed]
<ul>
<li><s>Additionally, because PSA is running as a single instance app, any UI will also be terminated, when the background task is terminated.</s> [Fixed]</li>
</ul>
</li>
<li><s>The default print ticket received in the printing app does not have the updated PDC, after the PDC was updated by PSA.</s> [Fixed in 2020-07-14 build]
<ul>
<li><s>Currently PDC edits does not support changing of default media size.</s> [By Design]</li>
<li><s>Update PDC example is not updated yet.</s> [Fixed in V4]</li>
</ul>
</li>
<li><s>Upon calling <code>PrintWorkflowPdlDataAvailableEventArgs.PrintWorkflowConfiguration.AbortPrintFlow</code>, the print queue will show the status of the print job as &quot;Deleting&quot;, and the job will stay in the queue in a broken state.</s> [Fixed]</li>
<li><s>PSA is NOT closed after setting the watermark and selecting <code>Print</code>.</s> [Fixed in 2020-07-14 build]
<ul>
<li><s>Once the background tasks can run out-of-proc &amp; PSA can run as a multi-instance app, this issue will be fixed.</s></li>
</ul>
</li>
</ul>
</details>
<h2 id="remarks">Remarks</h2>
<details>
<ul>
<li>
<p><s>The current manifest contract (windows.printWorkflowBackgroundTask) used in the sample app is not the final/correct contract for a Print Support App. We are temporarly using this contract until the new PSA contracts are added to the SDK.</s> [Fixed in 2020-06-30 build]</p>
</li>
<li>
<p>For builds 2020-06-30 and above, please make sure the following contract IDs are removed from the <code>Package.appxmanifest</code> file.</p>
<ul>
<li><code>windows.printTaskSettings</code></li>
<li><code>windows.printWorkflowBackgroundTask</code></li>
<li><code>windows.printWorkflowForegroundTask</code></li>
</ul>
</li>
</ul>
</details>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/uwp/launch-resume/multi-instance-uwp">Create a multi-instance Universal Windows App</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/install/using-an-extension-inf-file">Using an Extension INF File</a></li>
<li><a href="https://docs.microsoft.com/en-us/uwp/api/windows.data.xml.dom">Windows.Data.Xml.Dom</a>
<ul>
<li><a href="https://www.w3schools.com/xml/xpath_syntax.asp">XPath Syntax</a></li>
</ul>
</li>
<li><a href="https://docs.microsoft.com/en-us/uwp/api/windows.graphics.printing.printticket">Windows.Graphics.Printing.PrintTicket</a></li>
</ul>

</body>
</html>
